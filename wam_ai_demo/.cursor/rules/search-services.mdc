---
alwaysApply: true
---

# WAM AI Demo - Cortex Search Services Rules

## Current Services
- `COMMUNICATIONS_SEARCH`: Client communications (emails, calls, meetings)
  - ATTRIBUTES: `CLIENT_ID, ADVISOR_ID, TIMESTAMP, CHANNEL`
- `RESEARCH_SEARCH`: Investment research and analyst reports
  - ATTRIBUTES: `TICKER, DOCUMENT_TYPE, PUBLISH_DATE, SOURCE`  
- `REGULATORY_SEARCH`: Compliance rules and guidance
  - ATTRIBUTES: `REGULATOR, RULE_ID, PUBLISH_DATE, TITLE`
- `PLANNING_SEARCH`: Financial planning documents (plans, IPS, policies)
  - ATTRIBUTES: `CLIENT_ID, ADVISOR_ID, DOCUMENT_TYPE, LAST_UPDATE`
- `DEPARTURE_SEARCH`: Exit questionnaires and departure feedback
  - ATTRIBUTES: `CLIENT_ID, ADVISOR_ID, DOCUMENT_TYPE, DEPARTURE_REASON, DOCUMENT_DATE`

## Critical Syntax Pattern
```sql
CREATE OR REPLACE CORTEX SEARCH SERVICE service_name
    ON content_column
    ATTRIBUTES attribute1, attribute2, attribute3
    WAREHOUSE = warehouse_name
    TARGET_LAG = '5 minutes'
    AS 
    SELECT 
        id_column,
        title_column AS TITLE,
        content_column,
        attribute_columns
    FROM corpus_table
```

## Critical Requirements
- **ATTRIBUTES must match SELECT columns**: If SELECT has `TITLE`, ATTRIBUTES must include `TITLE`
- **ON content_column**: Specify the searchable content column
- **WAREHOUSE is mandatory**: Use `WAM_AI_CORTEX_WH` or `CURRENT_WAREHOUSE()`
- **TARGET_LAG**: Use '5 minutes' for demos

## Validation Pattern
```sql
-- Test search service
SELECT SNOWFLAKE.CORTEX.SEARCH_PREVIEW(
    'WAM_AI_DEMO.AI.SERVICE_NAME',
    '{"query": "test", "limit": 1}'
);
```

## Common Errors
- **"Missing option WAREHOUSE"**: Add WAREHOUSE parameter
- **"invalid identifier"**: ATTRIBUTES don't match SELECT columns
- **"table not found"**: Verify corpus table exists

@src/create_search_services.py