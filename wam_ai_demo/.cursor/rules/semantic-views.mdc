---
alwaysApply: true
---

# WAM AI Demo - Semantic Views Rules

## File Organization
- **SINGLE FILE**: All semantic view creation must be in `src/create_semantic_views.py`
- **NO SEPARATE FILES**: Do not create separate files for themed semantic views

## Current Views
- `CLIENT_FINANCIALS_SV`: Portfolio metrics with issuer/sector hierarchy
- `CLIENT_INTERACTIONS_SV`: Communication patterns and metrics  
- `WATCHLIST_ANALYTICS_SV`: Thematic watchlist analytics (Phase 2)

## Semantic View Creation Template

```sql
CREATE OR REPLACE SEMANTIC VIEW {database}.{schema}.{semantic_view_name}
TABLES (
	<table_alias> AS <physical_table_name>
    	PRIMARY KEY (column1, column2) 
	    WITH SYNONYMS=('synonym1','synonym2') 
    	COMMENT='Table description'
)
RELATIONSHIPS (
	<relationship_name> AS <table_alias>(foreign_key_column) REFERENCES <table_alias>(primary_key_column)
)
FACTS (
	<table_alias>.<fact_name> AS <physical_table_name column_name or sql_expr> WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'
)
DIMENSIONS (
	<table_alias>.<dimension_name> AS <physical_table_name column_name or sql_expr> WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'
)
METRICS (
	<table_alias>.<metric_name> AS <aggregation_function>(<physical_table_name column_name or sql_expr>) WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'
)
```

**REQUIRED SECTIONS**: TABLES and at least one DIMENSIONS or METRICS section

### Section Definitions

**TABLES**: Tables are logical tables that typically correspond to business entities, such as customers, portfolios, or accounts.

**RELATIONSHIPS**: Relationships between logical tables through joins on shared keys, enabling analysis of data across entities.

**FACTS**: Facts are row-level attributes. Facts capture "how much" or "how many" at the most granular level, such as individual sales amounts, quantities purchased, or costs. Facts typically function as "helper" concepts within the semantic view to help construct dimensions and metrics.

**METRICS**: Metrics are quantifiable measures calculated by aggregating facts or other columns from the same table. Examples include Total Revenue or Profit Margin Percentage. A metric must use an aggregate function.

**DIMENSIONS**: Dimensions represent categorical attributes. They answer "who," "what," "where," and "when" questions.

### Correct Syntax Format (CRITICAL)

Follow these exact patterns for ALL sections:

**TABLES Section (One or Multiple):**
```sql
<table_alias> AS <physical_table_name>
    PRIMARY KEY (column1, column2) 
    WITH SYNONYMS=('synonym1','synonym2') 
    COMMENT='Table description'
```

**RELATIONSHIPS Section (One or Multiple):**
```sql
<relationship_name> AS <table_alias>(foreign_key_column) REFERENCES <table_alias>(primary_key_column)
```

**DIMENSIONS Section (One or Multiple):**
```sql
<table_alias>.<dimension_name> AS <column_name> WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'
```

**METRICS Section (One or Multiple):**
```sql
<table_alias>.<metric_name> AS <aggregation_function>(<column_name>) WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'
```

## Legacy Syntax Examples

### Table Declaration
```sql
-- ✅ CORRECT
HOLDINGS AS WAM_AI_DEMO.CURATED.FACT_POSITION_DAILY_ABOR
    PRIMARY KEY (HOLDINGDATE, PORTFOLIOID, SECURITYID) 
    WITH SYNONYMS=('positions','investments') 
    COMMENT='Daily portfolio holdings'
```

### Relationship Declaration
```sql
-- ✅ CORRECT
HOLDINGS_TO_PORTFOLIOS AS HOLDINGS(PORTFOLIOID) REFERENCES PORTFOLIOS(PORTFOLIOID)
```

### Dimensions
```sql
-- ✅ CORRECT pattern
table_alias.column_name AS dimension_name WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'

-- ✅ CORRECT examples
PORTFOLIOS.PORTFOLIO_NAME AS PORTFOLIONAME WITH SYNONYMS=('fund_name','strategy_name') COMMENT='Portfolio name'
SECURITIES.TICKER AS PRIMARYTICKER WITH SYNONYMS=('ticker_symbol','symbol') COMMENT='Primary trading symbol'
```

### Metrics
```sql
-- ✅ CORRECT pattern (NO PUBLIC keyword)
table_alias.metric_name AS AGGREGATION(column) WITH SYNONYMS=('synonym1','synonym2') COMMENT='Description'

-- ✅ CORRECT examples  
HOLDINGS.TOTAL_MARKET_VALUE AS SUM(MARKETVALUE_BASE) WITH SYNONYMS=('exposure','aum') COMMENT='Total market value'
HOLDINGS.HOLDING_COUNT AS COUNT(SECURITYID) WITH SYNONYMS=('position_count','count') COMMENT='Number of positions'
```

## Formatting Requirements
- **Indentation**: Use tabs, not spaces
- **Synonyms**: Use `WITH SYNONYMS=()` format (equals sign, no spaces)
- **Unique Synonyms**: Each synonym can only appear once across all dimensions/metrics
- **No PUBLIC Keyword**: Never use PUBLIC in DIMENSIONS or METRICS sections

## Validation Pattern
```sql
-- Test semantic view creation
SELECT * FROM SEMANTIC_VIEW(
    WAM_AI_DEMO.AI.VIEW_NAME
    METRICS metric_name
    DIMENSIONS dimension_name
) LIMIT 5;
```

@src/create_semantic_views.py