---
description: Unified configuration management system for Glacier First Bank demo with scalable defaults
alwaysApply: false
---
# Glacier First Bank â€” Configuration Management System

## Overview
This rule defines the unified configuration management system supporting all phases of the Glacier First Bank demo, with scalable data generation, configurable market themes, and external data provider simulation.

## Master Configuration Schema

### Configuration File Structure
```yaml
# config/glacier_demo_config.yaml

# Global Settings
global:
  demo_name: "Glacier First Bank AI Intelligence Demo"
  institution_name: "Glacier First Bank"
  institution_profile: "pan-EU universal bank; strong Corporate & Commercial; strong Wealth"
  
  # Environment Configuration
  snowflake:
    database: "BANK_AI_DEMO"
    compute_warehouse: "BANK_AI_DEMO_COMPUTE_WH"
    search_warehouse: "BANK_AI_DEMO_SEARCH_WH"
    connection_name: "${CONNECTION_NAME}"  # Parameter injection
    connection_fallback: "sfseeurope-mstellwall-aws-us-west3"
  
  # Demo Standards
  language: "en-GB"
  currency: "EUR"
  currency_format: "â‚¬1,234,567.89"  # en-GB with euro symbol
  regulatory_framework: "EU/EBA"
  timezone: "Europe/Brussels"
  
  # Content Generation
  llm_model: "llama3.1-70b"
  generation_temperature: 0.7
  generation_seed: 42  # For reproducible content
  max_tokens: 4000

# Phase Configuration
phases:
  current_phase: 1
  
  phase_1:
    name: "Foundation - AML/KYC & Credit Analysis"
    scenarios: ["aml_kyc_edd", "credit_analysis"]
    completion_criteria:
      - "Both scenarios work end-to-end with realistic data"
      - "Cross-domain intelligence connections demonstrable"
      - "All wow moments polished and reliable"
      - "Presenter guidance complete"
  
  phase_2:
    name: "Expansion - Corporate RM & Investment Banking"
    scenarios: ["corporate_rm", "ma_analyst"]
    dependencies: ["phase_1"]
  
  phase_3:
    name: "Wealth Management"
    scenarios: ["wealth_advisor"]
    dependencies: ["phase_2"]

# Data Generation Configuration
data_generation:
  # Scale Configuration
  scales:
    mini:
      description: "Fast testing scale"
      entities: 50
      entity_relationships: 100
      customers: 25
      transactions: 5000
      compliance_documents: 100
      loan_applications: 5
      historical_loans: 150
      news_articles: 150
      
    demo:
      description: "Balanced demo scale - optimal for agent responses"
      entities: 500
      entity_relationships: 1200
      customers: 200
      transactions: 50000
      compliance_documents: 800
      loan_applications: 25
      historical_loans: 1500
      news_articles: 1200
      
    full:
      description: "Large scale for stress testing"
      entities: 2000
      entity_relationships: 5000
      customers: 800
      transactions: 200000
      compliance_documents: 3000
      loan_applications: 100
      historical_loans: 6000
      news_articles: 5000
  
  # Default scale
  default_scale: "demo"
  
  # Date Ranges
  date_ranges:
    historical_start: "2019-01-01"
    historical_end: "2024-09-30"
    current_date: "2024-09-30"
    future_projections: "2026-12-31"
  
  # Entity Specifications
  key_entities:
    primary_aml_subject:
      entity_id: "GTV_SA_001"
      name: "Global Trade Ventures S.A."
      country: "LUX"
      industry: "International Trade"
      esg_rating: "C+"
      
    primary_credit_applicant:
      entity_id: "INN_DE_001"
      name: "Innovate GmbH"
      country: "DEU"
      industry: "Software Services"
      esg_rating: "B+"
      
    shared_risk_vendor:
      entity_id: "NSC_UK_001"
      name: "Northern Supply Chain Ltd"
      country: "GBR"
      industry: "Logistics & Transportation"
      risk_profile: "HIGH"

# Market Context Themes
market_themes:
  current_themes:
    - name: "ESG Compliance"
      weight: 0.30
      keywords: ["sustainability", "ESG reporting", "green finance", "carbon footprint", "sustainable development goals"]
      document_types: ["policy_docs", "news_articles", "research_reports"]
      
    - name: "Supply Chain Risk"
      weight: 0.25
      keywords: ["supply chain disruption", "geopolitical risk", "logistics", "vendor dependency", "supply chain resilience"]
      document_types: ["news_articles", "risk_reports", "compliance_documents"]
      
    - name: "Inflation Impact"
      weight: 0.20
      keywords: ["inflation", "interest rates", "debt service", "margin pressure", "cost inflation"]
      document_types: ["credit_documents", "financial_analysis", "market_reports"]
      
    - name: "Digital Transformation"
      weight: 0.15
      keywords: ["digitalization", "AI adoption", "cybersecurity", "cloud migration", "automation"]
      document_types: ["business_plans", "technology_reports"]
      
    - name: "Regulatory Change"
      weight: 0.10
      keywords: ["regulatory update", "compliance requirements", "Basel III", "MiFID II", "AML directive"]
      document_types: ["policy_docs", "regulatory_updates"]

# External Data Provider Simulation
external_data_providers:
  financial_data:
    provider: "S&P Global Market Intelligence"
    marketplace_attribution: "S&P Global Market Intelligence via Snowflake Marketplace"
    data_types: ["company_financials", "credit_ratings", "industry_benchmarks"]
    update_frequency: "daily"
    schema_pattern: "SP_GLOBAL_*"
    
  news_feeds:
    provider: "Reuters"
    marketplace_attribution: "Reuters News Feed via Snowflake Marketplace"
    data_types: ["news_articles", "press_releases", "market_updates"]
    update_frequency: "real-time"
    schema_pattern: "REUTERS_*"
    
  regulatory_intelligence:
    provider: "Thomson Reuters"
    marketplace_attribution: "Thomson Reuters Regulatory Intelligence via Snowflake Marketplace"
    data_types: ["regulatory_updates", "policy_documents", "compliance_guidance"]
    update_frequency: "daily"
    schema_pattern: "TR_REGULATORY_*"
    
  esg_ratings:
    provider: "MSCI"
    marketplace_attribution: "MSCI ESG Ratings via Snowflake Marketplace"
    data_types: ["esg_scores", "sustainability_metrics", "carbon_data"]
    update_frequency: "monthly"
    schema_pattern: "MSCI_ESG_*"
    
  risk_compliance:
    provider: "Dow Jones"
    marketplace_attribution: "Dow Jones Risk & Compliance via Snowflake Marketplace"
    data_types: ["sanctions_lists", "pep_lists", "adverse_media"]
    update_frequency: "real-time"
    schema_pattern: "DJ_RISK_*"

# Document Generation Configuration
document_generation:
  types:
    compliance_documents:
      onboarding:
        table_name: "ONBOARDING_DOCS_RAW"
        corpus_name: "COMPLIANCE_DOCUMENTS"
        word_count_range: [800, 1500]
        sections: ["corporate_structure", "beneficial_ownership", "business_purpose", "regulatory_status"]
        
      adverse_media:
        table_name: "ADVERSE_MEDIA_RAW"
        corpus_name: "COMPLIANCE_DOCUMENTS"
        word_count_range: [400, 800]
        sections: ["headline", "allegations", "investigation_status", "impact_assessment"]
        
      pep_sanctions:
        table_name: "PEP_SANCTIONS_RAW"
        corpus_name: "COMPLIANCE_DOCUMENTS"
        word_count_range: [200, 400]
        sections: ["individual_profile", "position_history", "risk_assessment"]
        
    credit_documents:
      business_plans:
        table_name: "BUSINESS_PLANS_RAW"
        corpus_name: "LOAN_DOCUMENTS"
        word_count_range: [2000, 4000]
        sections: ["executive_summary", "market_strategy", "financial_projections", "key_personnel", "risk_factors"]
        
      financial_statements:
        table_name: "FINANCIAL_STATEMENTS_RAW"
        corpus_name: "LOAN_DOCUMENTS"
        word_count_range: [1500, 2500]
        sections: ["balance_sheet_analysis", "income_statement_review", "cash_flow_analysis", "ratio_analysis"]
        
      policy_documents:
        table_name: "POLICY_DOCS_RAW"
        corpus_name: "CREDIT_POLICY_DOCUMENTS"
        word_count_range: [1000, 2000]
        sections: ["policy_statement", "threshold_definitions", "approval_procedures", "monitoring_requirements"]
        
    market_intelligence:
      news_articles:
        table_name: "NEWS_ARTICLES_RAW"
        corpus_name: "NEWS_AND_RESEARCH"
        word_count_range: [300, 600]
        sections: ["headline", "summary", "market_impact", "expert_analysis"]
        
      research_reports:
        table_name: "RESEARCH_REPORTS_RAW"
        corpus_name: "NEWS_AND_RESEARCH"
        word_count_range: [1200, 2400]
        sections: ["executive_summary", "industry_analysis", "company_assessment", "recommendations"]

# Policy Thresholds Configuration
policy_thresholds:
  credit_risk:
    debt_service_coverage_ratio:
      warning_threshold: 1.25
      breach_threshold: 1.10
      direction: "minimum"
      policy_reference: "Mid-Market Lending Policy v3.2, Section 4.1.2"
      
    debt_to_equity_ratio:
      warning_threshold: 3.0
      breach_threshold: 3.5
      direction: "maximum"
      policy_reference: "Mid-Market Lending Policy v3.2, Section 4.1.1"
      
    current_ratio:
      warning_threshold: 1.20
      breach_threshold: 1.10
      direction: "minimum"
      policy_reference: "Mid-Market Lending Policy v3.2, Section 4.1.3"
      
    client_concentration:
      warning_threshold: 60
      breach_threshold: 70
      direction: "maximum"
      unit: "percentage"
      policy_reference: "Commercial Credit Risk Policy v2.1, Section 5.3.1"
      
  portfolio_limits:
    single_vendor_exposure:
      warning_threshold: 15
      breach_threshold: 20
      direction: "maximum"
      unit: "percentage"
      policy_reference: "Portfolio Risk Management Policy v1.4, Section 3.2"
      
    industry_concentration:
      warning_threshold: 25
      breach_threshold: 30
      direction: "maximum"
      unit: "percentage"
      policy_reference: "Portfolio Risk Management Policy v1.4, Section 3.1"

# Agent Configuration Templates
agent_templates:
  response_instructions_common: |
    Use concise, professional en-GB banking tone. Always cite source document ID/title and publish/effective dates.
    State currency (EUR), period, and cohort filters in quantitative answers.
    Apply severity icons for thresholds: âš ï¸ warning, ðŸš¨ breach.
    Offer "Show SQL" and "Audit summary of steps and sources" on request.
    
  planning_instructions_common: |
    If quantitative metrics/cohorts over structured data â†’ use Cortex Analyst on the scenario's Semantic View.
    If interrogating documents/policies/news/adverse media â†’ use Cortex Search with attribute filters.
    If both are relevant â†’ use both tools and synthesise findings into one answer.
    Only reveal SQL when the user requests it (UI-handled).
    
  visual_defaults:
    time_series: "Line chart"
    cohort_comparisons: "Horizontal bar chart"
    composition: "Stacked bar chart"
    distribution: "Histogram"
    kpi_vs_threshold: "Inline KPI with colour flag; optional small comparative bar"

# Quality Assurance Configuration
quality_assurance:
  data_integrity_checks:
    - "All foreign key relationships valid"
    - "Financial ratios mathematically consistent"
    - "Date ranges logically ordered"
    - "Risk scores align with supporting evidence"
    
  content_quality_gates:
    min_word_count: 100
    max_word_count: 5000
    prohibited_phrases: ["I cannot", "I apologize", "I'm sorry", "I don't know"]
    required_elements: ["specific_dates", "entity_names", "quantified_metrics"]
    
  performance_targets:
    simple_queries: 5  # seconds
    complex_analysis: 15  # seconds
    cross_domain_intelligence: 20  # seconds
    document_synthesis: 10  # seconds
    
  validation_requirements:
    - "Cross-scenario entity consistency"
    - "Timeline alignment across all data"
    - "Risk assessment correlation"
    - "Business relationship mathematical consistency"

# Deployment Configuration
deployment:
  environments:
    development:
      scale: "mini"
      debug_mode: true
      validation_strict: false
      
    demo:
      scale: "demo"
      debug_mode: false
      validation_strict: true
      performance_monitoring: true
      
    production:
      scale: "full"
      debug_mode: false
      validation_strict: true
      performance_monitoring: true
      audit_logging: true
      
  feature_flags:
    enable_cross_domain_intelligence: true
    enable_contradictory_evidence_synthesis: true
    enable_multi_step_reasoning: true
    enable_external_data_attribution: true
    enable_performance_monitoring: true
    
  monitoring:
    response_time_alerts: true
    data_quality_alerts: true
    agent_performance_tracking: true
    usage_analytics: true

# Localization Support
localization:
  supported_languages: ["en-GB"]
  date_formats:
    "en-GB": "DD/MM/YYYY"
  number_formats:
    "en-GB": "1,234,567.89"
  currency_formats:
    "en-GB": "â‚¬1,234,567.89"
    
# Extension Points for Future Phases
extensions:
  phase_2_additions:
    - "Corporate RM semantic views"
    - "M&A target screening data"
    - "Client intelligence documents"
    
  phase_3_additions:
    - "Wealth management portfolios"
    - "Investment research documents"
    - "Client meeting notes"
    
  custom_tools:
    - "Portfolio modeling UDF"
    - "Risk scenario simulation"
    - "Regulatory impact assessment"
```

## Configuration Management Patterns

### Environment-Specific Configuration Loading
```python
import yaml
import os
from typing import Dict, Any

class GlacierDemoConfig:
    """Unified configuration manager for Glacier First Bank demo."""
    
    def __init__(self, config_path: str = "config/glacier_demo_config.yaml", 
                 connection_name: str = None):
        self.config_path = config_path
        self.connection_name = connection_name or os.getenv('CONNECTION_NAME')
        self.config = self._load_config()
        self._validate_config()
    
    def _load_config(self) -> Dict[str, Any]:
        """Load configuration with parameter substitution."""
        with open(self.config_path, 'r') as f:
            config = yaml.safe_load(f)
        
        # Parameter substitution
        if self.connection_name:
            config['global']['snowflake']['connection_name'] = self.connection_name
        else:
            config['global']['snowflake']['connection_name'] = config['global']['snowflake']['connection_fallback']
        
        return config
    
    def get_scale_config(self, scale: str = None) -> Dict[str, int]:
        """Get data generation scale configuration."""
        scale = scale or self.config['data_generation']['default_scale']
        return self.config['data_generation']['scales'][scale]
    
    def get_entity_config(self, entity_key: str) -> Dict[str, Any]:
        """Get specific entity configuration."""
        return self.config['data_generation']['key_entities'][entity_key]
    
    def get_policy_threshold(self, metric: str) -> Dict[str, Any]:
        """Get policy threshold configuration for specific metric."""
        for category, thresholds in self.config['policy_thresholds'].items():
            if metric in thresholds:
                return thresholds[metric]
        raise ValueError(f"Policy threshold not found for metric: {metric}")
    
    def get_market_themes(self) -> Dict[str, Any]:
        """Get current market themes configuration."""
        return self.config['market_themes']['current_themes']
    
    def get_external_provider(self, provider_type: str) -> Dict[str, Any]:
        """Get external data provider configuration."""
        return self.config['external_data_providers'][provider_type]
    
    def get_document_config(self, doc_category: str, doc_type: str) -> Dict[str, Any]:
        """Get document generation configuration."""
        return self.config['document_generation']['types'][doc_category][doc_type]
    
    def _validate_config(self):
        """Validate configuration consistency and completeness."""
        required_sections = [
            'global', 'phases', 'data_generation', 'market_themes',
            'external_data_providers', 'policy_thresholds'
        ]
        
        for section in required_sections:
            if section not in self.config:
                raise ValueError(f"Missing required configuration section: {section}")
        
        # Validate current phase exists
        current_phase = self.config['phases']['current_phase']
        phase_key = f"phase_{current_phase}"
        if phase_key not in self.config['phases']:
            raise ValueError(f"Current phase {current_phase} not defined in configuration")
        
        # Validate default scale exists
        default_scale = self.config['data_generation']['default_scale']
        if default_scale not in self.config['data_generation']['scales']:
            raise ValueError(f"Default scale {default_scale} not defined in scales")
```

### Configuration-Driven Data Generation
```python
def generate_entities_from_config(session: Session, config: GlacierDemoConfig, 
                                 scale: str = None) -> None:
    """Generate entities based on configuration specifications."""
    
    scale_config = config.get_scale_config(scale)
    key_entities = config.config['data_generation']['key_entities']
    
    # Generate key entities first (guaranteed to exist for scenarios)
    key_entity_data = []
    for entity_key, entity_spec in key_entities.items():
        key_entity_data.append({
            'entity_id': entity_spec['entity_id'],
            'entity_name': entity_spec['name'],
            'country_code': entity_spec['country'],
            'industry_sector': entity_spec['industry'],
            'esg_rating': entity_spec.get('esg_rating'),
            'entity_type': 'CORPORATE'
        })
    
    # Generate additional entities to reach scale target
    additional_entities = scale_config['entities'] - len(key_entity_data)
    
    # Create and populate entities table
    entities_df = session.create_dataframe(key_entity_data + generate_additional_entities(additional_entities))
    entities_df.write.save_as_table("BANK_AI_DEMO.RAW_DATA.ENTITIES", mode="overwrite")
```

### Theme-Driven Content Generation
```python
def generate_themed_documents(session: Session, config: GlacierDemoConfig, 
                             doc_category: str, doc_type: str) -> None:
    """Generate documents with market theme integration."""
    
    doc_config = config.get_document_config(doc_category, doc_type)
    themes = config.get_market_themes()
    
    # Filter themes relevant to this document type
    relevant_themes = [theme for theme in themes 
                      if doc_type in theme['document_types']]
    
    # Generate prompts with theme integration
    prompts = []
    for entity in get_entities_for_doc_type(session, doc_type):
        # Select theme based on weight
        selected_theme = select_weighted_theme(relevant_themes)
        
        prompt = build_themed_prompt(
            entity=entity,
            doc_type=doc_type,
            theme=selected_theme,
            word_count=doc_config['word_count_range'],
            sections=doc_config['sections'],
            language=config.config['global']['language']
        )
        
        prompts.append({
            'prompt_id': str(uuid.uuid4()),
            'entity_id': entity['entity_id'],
            'document_type': doc_type,
            'theme': selected_theme['name'],
            'prompt_text': prompt
        })
    
    # Generate content using Cortex Complete
    prompts_df = session.create_dataframe(prompts)
    
    content_df = prompts_df.with_column(
        "DOCUMENT_TEXT",
        call_function(
            "SNOWFLAKE.CORTEX.COMPLETE",
            lit(config.config['global']['llm_model']),
            col("prompt_text")
        )
    )
    
    content_df.write.save_as_table(f"BANK_AI_DEMO.RAW_DATA.{doc_config['table_name']}", mode="overwrite")
```

## Configuration Validation Framework

### Runtime Configuration Validation
```python
class ConfigValidator:
    """Validates configuration consistency and data generation requirements."""
    
    def __init__(self, config: GlacierDemoConfig):
        self.config = config
        
    def validate_phase_requirements(self, phase: int) -> List[str]:
        """Validate that configuration supports specified phase requirements."""
        errors = []
        
        phase_config = self.config.config['phases'][f'phase_{phase}']
        
        # Validate scenario support
        for scenario in phase_config['scenarios']:
            if not self._validate_scenario_config(scenario):
                errors.append(f"Scenario {scenario} missing required configuration")
        
        # Validate data dependencies
        if not self._validate_data_dependencies(phase):
            errors.append(f"Phase {phase} data dependencies not satisfied")
            
        return errors
    
    def validate_agent_configuration(self, agent_name: str) -> List[str]:
        """Validate agent configuration completeness."""
        errors = []
        
        # Check semantic view dependencies
        if not self._check_semantic_view_dependencies(agent_name):
            errors.append(f"Agent {agent_name} semantic view dependencies not met")
        
        # Check search service dependencies
        if not self._check_search_service_dependencies(agent_name):
            errors.append(f"Agent {agent_name} search service dependencies not met")
            
        return errors
    
    def validate_policy_thresholds(self) -> List[str]:
        """Validate policy threshold consistency."""
        errors = []
        
        thresholds = self.config.config['policy_thresholds']
        
        for category, metrics in thresholds.items():
            for metric, config in metrics.items():
                if not self._validate_threshold_config(metric, config):
                    errors.append(f"Invalid threshold configuration for {category}.{metric}")
                    
        return errors
```

## Usage Patterns

### Basic Configuration Usage
```python
# Initialize configuration
config = GlacierDemoConfig(connection_name="my_snowflake_connection")

# Get data generation scale
scale_config = config.get_scale_config("demo")
print(f"Generating {scale_config['entities']} entities")

# Get policy threshold for validation
dscr_threshold = config.get_policy_threshold("debt_service_coverage_ratio")
print(f"DSCR warning threshold: {dscr_threshold['warning_threshold']}")

# Get market themes for content generation
themes = config.get_market_themes()
esg_theme = next(theme for theme in themes if theme['name'] == 'ESG Compliance')
print(f"ESG theme weight: {esg_theme['weight']}")
```

### Environment-Specific Deployment
```python
# Development environment
dev_config = GlacierDemoConfig()
dev_config.config['deployment']['environments']['development']['scale'] = "mini"

# Demo environment
demo_config = GlacierDemoConfig()
demo_config.config['deployment']['environments']['demo']['performance_monitoring'] = True

# Production environment
prod_config = GlacierDemoConfig()
prod_config.config['deployment']['environments']['production']['audit_logging'] = True
```

## Configuration Extension Points

### Adding New Phases
```yaml
# Add to phases section
phase_4:
  name: "Advanced Analytics"
  scenarios: ["risk_modeling", "regulatory_reporting"]
  dependencies: ["phase_3"]
```

### Adding New Document Types
```yaml
# Add to document_generation.types
regulatory_reports:
  stress_testing:
    table_name: "STRESS_TEST_RAW"
    corpus_name: "REGULATORY_DOCUMENTS"
    word_count_range: [2000, 4000]
    sections: ["methodology", "scenarios", "results", "capital_impact"]
```

### Adding New External Providers
```yaml
# Add to external_data_providers
alternative_data:
  provider: "Satellite Analytics Inc"
  marketplace_attribution: "Satellite Analytics Inc via Snowflake Marketplace"
  data_types: ["economic_indicators", "supply_chain_metrics"]
  update_frequency: "weekly"
  schema_pattern: "SAT_ANALYTICS_*"
```

This configuration management system provides:

1. **Unified Control**: Single source of truth for all demo parameters
2. **Environment Flexibility**: Easy switching between development, demo, and production scales
3. **Theme Integration**: Consistent market theme application across all generated content
4. **External Provider Simulation**: Realistic data source attribution for marketplace story
5. **Quality Assurance**: Built-in validation and quality gates
6. **Extensibility**: Clear patterns for adding new phases, scenarios, and data types
7. **Performance Optimization**: Configurable scales and performance targets
8. **Auditability**: Complete configuration tracking and validation logging