---
description: Complete semantic view definitions for Glacier First Bank Phase 1 scenarios with cross-domain intelligence
alwaysApply: false
---
# Glacier First Bank â€” Phase 1 Semantic Views

## Overview
This rule defines the complete semantic views for Phase 1 scenarios (AML/KYC EDD + Credit Analyst) enabling cross-domain intelligence through shared ecosystem relationships and multi-step analytical reasoning.

## Semantic View: credit_risk_sv

### Purpose
Enables credit analysts to perform ratio analysis, cohort comparisons, and portfolio concentration analysis with access to historical loan performance data for sophisticated risk assessment.

### Definition
```sql
CREATE OR REPLACE SEMANTIC VIEW BANK_AI_DEMO.SEMANTIC_LAYER.credit_risk_sv
TABLES (
    applications AS BANK_AI_DEMO.RAW_DATA.LOAN_APPLICATIONS
        PRIMARY KEY (application_id)
        WITH SYNONYMS=('loan applications', 'credit applications', 'applicants')
        COMMENT='Current loan applications under review',
    
    history AS BANK_AI_DEMO.RAW_DATA.HISTORICAL_LOANS
        PRIMARY KEY (loan_id)
        WITH SYNONYMS=('historical loans', 'past loans', 'loan history', 'performance data')
        COMMENT='Historical loan performance data for cohort analysis',
    
    customers AS BANK_AI_DEMO.RAW_DATA.CUSTOMERS
        PRIMARY KEY (customer_id)
        WITH SYNONYMS=('clients', 'borrowers')
        COMMENT='Customer profiles and risk ratings',
    
    entities AS BANK_AI_DEMO.RAW_DATA.ENTITIES
        PRIMARY KEY (entity_id)
        WITH SYNONYMS=('companies', 'organizations', 'borrowing entities')
        COMMENT='Entity master data with ESG ratings and industry classifications'
)
RELATIONSHIPS (
    applications_to_customers AS applications(customer_id) REFERENCES customers(customer_id),
    customers_to_entities AS customers(entity_id) REFERENCES entities(entity_id),
    history_to_customers AS history(customer_id) REFERENCES customers(customer_id)
)
FACTS (
    applications.requested_amount AS requested_amount 
        WITH SYNONYMS=('loan amount', 'credit amount', 'facility size')
        COMMENT='Amount of credit requested in EUR',
    
    applications.annual_revenue AS annual_revenue
        WITH SYNONYMS=('revenue', 'turnover', 'sales')
        COMMENT='Applicant annual revenue in EUR',
    
    applications.total_assets AS total_assets
        WITH SYNONYMS=('assets', 'total assets')
        COMMENT='Total assets on balance sheet in EUR',
    
    applications.ebitda AS ebitda
        WITH SYNONYMS=('earnings', 'operating income')
        COMMENT='Earnings before interest, taxes, depreciation, amortization in EUR',
    
    history.original_amount AS historical_loan_amount
        WITH SYNONYMS=('loan size', 'facility amount')
        COMMENT='Original loan amount for historical comparison'
)
DIMENSIONS (
    applications.applicant_name AS applicant_name
        WITH SYNONYMS=('borrower name', 'company name', 'client name')
        COMMENT='Name of the loan applicant',
    
    applications.industry_sector AS industry
        WITH SYNONYMS=('sector', 'industry sector', 'business sector')
        COMMENT='Industry classification of the applicant',
    
    entities.country_code AS country
        WITH SYNONYMS=('jurisdiction', 'domicile', 'incorporation country')
        COMMENT='Country of incorporation or primary operations',
    
    entities.esg_rating AS esg_rating
        WITH SYNONYMS=('sustainability rating', 'environmental rating')
        COMMENT='ESG rating from external provider',
    
    applications.status AS application_status
        WITH SYNONYMS=('loan status', 'application state')
        COMMENT='Current status of the loan application',
    
    history.loan_status AS historical_loan_status
        WITH SYNONYMS=('performance status', 'loan outcome')
        COMMENT='Final outcome of historical loans',
    
    history.industry_sector AS historical_industry
        WITH SYNONYMS=('historical sector', 'past industry')
        COMMENT='Industry sector for historical loan cohort analysis'
)
METRICS (
    applications.debt_service_coverage_ratio AS dscr
        WITH SYNONYMS=('debt service coverage', 'dscr ratio', 'cash flow coverage')
        COMMENT='Debt Service Coverage Ratio - ability to service debt payments',
    
    applications.debt_to_equity_ratio AS debt_to_equity
        WITH SYNONYMS=('leverage ratio', 'd/e ratio', 'gearing ratio')
        COMMENT='Debt-to-Equity ratio - financial leverage indicator',
    
    applications.current_ratio AS current_ratio
        WITH SYNONYMS=('liquidity ratio', 'working capital ratio')
        COMMENT='Current assets divided by current liabilities',
    
    applications.single_client_concentration_pct AS client_concentration
        WITH SYNONYMS=('customer concentration', 'revenue concentration', 'client dependency')
        COMMENT='Percentage of revenue from largest single client',
    
    history.cohort_default_rate AS (
        SUM(CASE WHEN history.loan_status = 'DEFAULTED' THEN 1 ELSE 0 END) * 100.0 / 
        COUNT(history.loan_id)
    ) WITH SYNONYMS=('default rate', 'loss rate', 'failure rate')
    COMMENT='Historical default rate for cohort analysis as percentage',
    
    applications.application_count AS COUNT(applications.application_id)
        WITH SYNONYMS=('number of applications', 'application volume')
        COMMENT='Count of loan applications',
    
    history.total_loss_amount AS SUM(COALESCE(history.loss_amount, 0))
        WITH SYNONYMS=('credit losses', 'loan losses', 'total losses')
        COMMENT='Total losses from defaulted loans in EUR'
)
COMMENT='Credit risk analysis view supporting loan origination, ratio analysis, and historical cohort performance';
```

### Test Queries
```sql
-- Basic functionality test
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.credit_risk_sv
    METRICS dscr, debt_to_equity, current_ratio
    DIMENSIONS applicant_name, industry
) WHERE applicant_name = 'Innovate GmbH' LIMIT 5;

-- Complex cohort analysis test
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.credit_risk_sv
    METRICS cohort_default_rate, total_loss_amount
    DIMENSIONS historical_industry, country
    FILTERS historical_industry = 'Software Services' 
        AND debt_to_equity > 3.0 
        AND client_concentration > 70
) LIMIT 10;

-- Cross-domain risk assessment
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.credit_risk_sv
    METRICS dscr, debt_to_equity, client_concentration
    DIMENSIONS applicant_name, esg_rating, industry
    FILTERS esg_rating IN ('C+', 'C', 'D')
) LIMIT 20;
```

## Semantic View: customer_risk_sv

### Purpose
Provides light AML/KYC context for cross-domain intelligence, enabling agents to correlate compliance risk with credit risk assessments.

### Definition
```sql
CREATE OR REPLACE SEMANTIC VIEW BANK_AI_DEMO.SEMANTIC_LAYER.customer_risk_sv
TABLES (
    customers AS BANK_AI_DEMO.RAW_DATA.CUSTOMERS
        PRIMARY KEY (customer_id)
        WITH SYNONYMS=('clients', 'account holders')
        COMMENT='Customer profiles with KYC and risk status',
    
    entities AS BANK_AI_DEMO.RAW_DATA.ENTITIES
        PRIMARY KEY (entity_id)
        WITH SYNONYMS=('companies', 'organizations')
        COMMENT='Entity master data with regulatory status',
    
    relationships AS BANK_AI_DEMO.RAW_DATA.ENTITY_RELATIONSHIPS
        PRIMARY KEY (relationship_id)
        WITH SYNONYMS=('connections', 'associations', 'links')
        COMMENT='Entity relationship network for risk contagion analysis',
    
    transactions AS BANK_AI_DEMO.RAW_DATA.TRANSACTIONS
        PRIMARY KEY (transaction_id)
        WITH SYNONYMS=('payments', 'transfers', 'transaction history')
        COMMENT='Transaction history for pattern analysis'
)
RELATIONSHIPS (
    customers_to_entities AS customers(entity_id) REFERENCES entities(entity_id),
    relationships_primary AS relationships(primary_entity_id) REFERENCES entities(entity_id),
    relationships_related AS relationships(related_entity_id) REFERENCES entities(entity_id),
    transactions_to_customers AS transactions(customer_id) REFERENCES customers(customer_id)
)
FACTS (
    transactions.amount AS transaction_amount
        WITH SYNONYMS=('payment amount', 'transfer value')
        COMMENT='Individual transaction amounts in EUR',
    
    relationships.risk_impact_score AS relationship_risk_score
        WITH SYNONYMS=('connection risk', 'association risk')
        COMMENT='Risk score for entity relationships (0.00 to 1.00)',
    
    transactions.risk_score AS transaction_risk_score
        WITH SYNONYMS=('payment risk', 'transaction risk')
        COMMENT='Risk score for individual transactions'
)
DIMENSIONS (
    entities.entity_name AS entity_name
        WITH SYNONYMS=('company name', 'client name', 'organization name')
        COMMENT='Name of the entity or customer',
    
    entities.country_code AS country
        WITH SYNONYMS=('jurisdiction', 'domicile')
        COMMENT='Country of incorporation or residence',
    
    customers.risk_rating AS risk_rating
        WITH SYNONYMS=('risk level', 'risk category')
        COMMENT='Overall customer risk rating',
    
    customers.kyc_status AS kyc_status
        WITH SYNONYMS=('due diligence status', 'compliance status')
        COMMENT='KYC completion and review status',
    
    entities.regulatory_status AS regulatory_status
        WITH SYNONYMS=('compliance status', 'regulatory standing')
        COMMENT='Current regulatory status of the entity',
    
    relationships.relationship_type AS relationship_type
        WITH SYNONYMS=('connection type', 'association type')
        COMMENT='Type of business relationship',
    
    relationships.relationship_strength AS relationship_strength
        WITH SYNONYMS=('connection strength', 'dependency level')
        COMMENT='Strength of the business relationship'
)
METRICS (
    customers.aml_flag_count AS SUM(customers.aml_flags)
        WITH SYNONYMS=('aml alerts', 'compliance flags', 'suspicious activity count')
        COMMENT='Total number of AML flags raised for customers',
    
    transactions.total_transaction_volume AS SUM(transactions.amount)
        WITH SYNONYMS=('transaction volume', 'payment volume', 'total transfers')
        COMMENT='Total transaction volume in EUR',
    
    transactions.high_risk_transaction_count AS (
        SUM(CASE WHEN transactions.risk_score > 0.7 THEN 1 ELSE 0 END)
    ) WITH SYNONYMS=('suspicious transactions', 'high risk payments')
    COMMENT='Count of transactions with high risk scores',
    
    relationships.average_relationship_risk AS AVG(relationships.risk_impact_score)
        WITH SYNONYMS=('network risk', 'ecosystem risk', 'connection risk')
        COMMENT='Average risk score across entity relationships',
    
    customers.customer_count AS COUNT(customers.customer_id)
        WITH SYNONYMS=('client count', 'number of customers')
        COMMENT='Total number of customers'
)
COMMENT='Customer risk profile view supporting AML/KYC analysis and cross-domain risk correlation';
```

### Test Queries
```sql
-- Basic customer risk profile
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.customer_risk_sv
    METRICS aml_flag_count, high_risk_transaction_count, average_relationship_risk
    DIMENSIONS entity_name, risk_rating, kyc_status
) WHERE entity_name IN ('Global Trade Ventures S.A.', 'Innovate GmbH') LIMIT 5;

-- Cross-domain ecosystem risk analysis
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.customer_risk_sv
    METRICS average_relationship_risk, customer_count
    DIMENSIONS relationship_type, relationship_strength
    FILTERS relationship_type = 'VENDOR'
) LIMIT 10;

-- Regulatory status correlation
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.customer_risk_sv
    METRICS aml_flag_count, total_transaction_volume
    DIMENSIONS entity_name, regulatory_status, country
    FILTERS regulatory_status IN ('UNDER_REVIEW', 'SANCTIONED')
) LIMIT 15;
```

## Semantic View: ecosystem_risk_sv

### Purpose
Specialized view for cross-domain intelligence analysis, enabling agents to identify risk contagion through shared vendors, partners, and industry relationships.

### Definition
```sql
CREATE OR REPLACE SEMANTIC VIEW BANK_AI_DEMO.SEMANTIC_LAYER.ecosystem_risk_sv
TABLES (
    relationships AS BANK_AI_DEMO.RAW_DATA.ENTITY_RELATIONSHIPS
        PRIMARY KEY (relationship_id)
        WITH SYNONYMS=('connections', 'associations', 'business links')
        COMMENT='Entity relationship network',
    
    primary_entities AS BANK_AI_DEMO.RAW_DATA.ENTITIES
        PRIMARY KEY (entity_id)
        WITH SYNONYMS=('primary companies', 'main entities')
        COMMENT='Primary entities in relationships',
    
    related_entities AS BANK_AI_DEMO.RAW_DATA.ENTITIES
        PRIMARY KEY (entity_id)
        WITH SYNONYMS=('related companies', 'connected entities', 'partners')
        COMMENT='Related entities in the ecosystem',
    
    customers AS BANK_AI_DEMO.RAW_DATA.CUSTOMERS
        PRIMARY KEY (customer_id)
        WITH SYNONYMS=('clients', 'bank customers')
        COMMENT='Bank customers linked to entities'
)
RELATIONSHIPS (
    relationships_to_primary AS relationships(primary_entity_id) REFERENCES primary_entities(entity_id),
    relationships_to_related AS relationships(related_entity_id) REFERENCES related_entities(entity_id),
    customers_to_primary AS customers(entity_id) REFERENCES primary_entities(entity_id)
)
FACTS (
    relationships.risk_impact_score AS relationship_risk_score
        WITH SYNONYMS=('connection risk', 'dependency risk')
        COMMENT='Risk impact score of the relationship'
)
DIMENSIONS (
    primary_entities.entity_name AS primary_entity_name
        WITH SYNONYMS=('main company', 'primary company', 'client name')
        COMMENT='Name of the primary entity in the relationship',
    
    related_entities.entity_name AS related_entity_name
        WITH SYNONYMS=('partner name', 'vendor name', 'connected company')
        COMMENT='Name of the related entity',
    
    relationships.relationship_type AS relationship_type
        WITH SYNONYMS=('connection type', 'business relationship')
        COMMENT='Type of business relationship',
    
    relationships.relationship_strength AS relationship_strength
        WITH SYNONYMS=('dependency level', 'connection importance')
        COMMENT='Strength of the relationship dependency',
    
    primary_entities.industry_sector AS primary_industry
        WITH SYNONYMS=('main industry', 'client industry')
        COMMENT='Industry sector of the primary entity',
    
    related_entities.industry_sector AS related_industry
        WITH SYNONYMS=('partner industry', 'vendor industry')
        COMMENT='Industry sector of the related entity',
    
    primary_entities.country_code AS primary_country
        WITH SYNONYMS=('client country', 'main jurisdiction')
        COMMENT='Country of the primary entity',
    
    related_entities.country_code AS related_country
        WITH SYNONYMS=('partner country', 'vendor jurisdiction')
        COMMENT='Country of the related entity'
)
METRICS (
    relationships.relationship_count AS COUNT(relationships.relationship_id)
        WITH SYNONYMS=('connection count', 'number of relationships')
        COMMENT='Total number of relationships',
    
    relationships.average_risk_impact AS AVG(relationships.risk_impact_score)
        WITH SYNONYMS=('average ecosystem risk', 'mean connection risk')
        COMMENT='Average risk impact across relationships',
    
    relationships.high_risk_relationship_count AS (
        SUM(CASE WHEN relationships.risk_impact_score > 0.7 THEN 1 ELSE 0 END)
    ) WITH SYNONYMS=('high risk connections', 'dangerous relationships')
    COMMENT='Count of high-risk relationships',
    
    relationships.vendor_dependency_count AS (
        SUM(CASE WHEN relationships.relationship_type = 'VENDOR' 
                 AND relationships.relationship_strength = 'PRIMARY' THEN 1 ELSE 0 END)
    ) WITH SYNONYMS=('critical vendor count', 'key supplier dependencies')
    COMMENT='Count of critical vendor dependencies'
)
COMMENT='Ecosystem risk analysis view for identifying risk contagion through shared business relationships';
```

### Test Queries
```sql
-- Cross-domain ecosystem analysis
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.ecosystem_risk_sv
    METRICS relationship_count, average_risk_impact, high_risk_relationship_count
    DIMENSIONS related_entity_name, relationship_type
    FILTERS related_entity_name = 'Northern Supply Chain Ltd'
) LIMIT 5;

-- Vendor risk contagion analysis
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.ecosystem_risk_sv
    METRICS vendor_dependency_count, average_risk_impact
    DIMENSIONS primary_entity_name, related_entity_name, relationship_strength
    FILTERS relationship_type = 'VENDOR' AND relationship_strength = 'PRIMARY'
) LIMIT 10;

-- Industry cluster risk assessment
SELECT * FROM SEMANTIC_VIEW(
    BANK_AI_DEMO.SEMANTIC_LAYER.ecosystem_risk_sv
    METRICS relationship_count, high_risk_relationship_count
    DIMENSIONS primary_industry, related_industry, primary_country
) LIMIT 15;
```

## Implementation Note

The Python implementation creates a simplified `cross_domain_intelligence_sv` view instead of the full `ecosystem_risk_sv` defined above. The simplified version:
- Uses only ENTITIES and ENTITY_RELATIONSHIPS tables
- Provides basic cross-domain intelligence capabilities
- Has corrected relationship definition: `relationships_to_entities AS relationships(PRIMARY_ENTITY_ID) REFERENCES entities(ENTITY_ID)`

Future implementations should consider using the full ecosystem_risk_sv definition for richer analysis capabilities.

## Cross-Domain Intelligence Patterns

### Multi-Step Reasoning Support
These semantic views enable agents to perform complex, multi-step analysis:

1. **Risk Contagion Analysis**:
   - Query `ecosystem_risk_sv` to identify shared vendors/partners
   - Cross-reference with `customer_risk_sv` for AML flags
   - Correlate with `credit_risk_sv` for financial impact assessment

2. **Contradictory Evidence Synthesis**:
   - Compare ESG ratings in `credit_risk_sv` with regulatory status in `customer_risk_sv`
   - Analyze financial strength vs relationship risk scores
   - Correlate historical performance with current risk indicators

3. **Portfolio Concentration Analysis**:
   - Use `credit_risk_sv` for client concentration metrics
   - Cross-reference with `ecosystem_risk_sv` for vendor concentration
   - Identify systemic risk through shared dependencies

### Agent Query Patterns
```sql
-- Example multi-domain query pattern for agents
-- Step 1: Identify high-risk relationships
WITH high_risk_vendors AS (
    SELECT * FROM SEMANTIC_VIEW(
        BANK_AI_DEMO.SEMANTIC_LAYER.ecosystem_risk_sv
        METRICS high_risk_relationship_count, average_risk_impact
        DIMENSIONS related_entity_name
        FILTERS relationship_type = 'VENDOR' AND average_risk_impact > 0.6
    )
),
-- Step 2: Find affected clients
affected_clients AS (
    SELECT * FROM SEMANTIC_VIEW(
        BANK_AI_DEMO.SEMANTIC_LAYER.customer_risk_sv
        METRICS aml_flag_count, total_transaction_volume
        DIMENSIONS entity_name, risk_rating
    )
),
-- Step 3: Assess credit impact
credit_exposure AS (
    SELECT * FROM SEMANTIC_VIEW(
        BANK_AI_DEMO.SEMANTIC_LAYER.credit_risk_sv
        METRICS dscr, debt_to_equity, client_concentration
        DIMENSIONS applicant_name
    )
)
SELECT * FROM high_risk_vendors 
JOIN affected_clients ON ...
JOIN credit_exposure ON ...;
```

## Validation and Testing Requirements

### Semantic View Validation Checklist
- [ ] All TABLES sections reference valid physical tables
- [ ] All RELATIONSHIPS are properly defined with valid foreign keys
- [ ] All DIMENSIONS use valid column references with unique synonyms
- [ ] All METRICS use proper aggregation functions
- [ ] Test queries return expected results for demo entities
- [ ] Cross-domain queries work across multiple semantic views
- [ ] Performance is acceptable for demo-scale data volumes

### Business Logic Validation
- [ ] Financial ratios calculate correctly and match expected thresholds
- [ ] Risk scores align with supporting evidence in source data
- [ ] Relationship dependencies reflect realistic business scenarios
- [ ] Historical cohort analysis produces meaningful default rates
- [ ] Cross-domain intelligence queries identify expected connections

### Agent Integration Testing
- [ ] Agents can successfully query all semantic views
- [ ] Multi-step reasoning patterns work as designed
- [ ] Contradictory evidence scenarios produce appropriate responses
- [ ] Cross-domain connections are discoverable through natural language queries
- [ ] Performance meets demo requirements (<10 seconds for complex queries)